# Erlang Concrete Data Types

[![Build Status](https://secure.travis-ci.org/apauley/erlcdt.png?branch=master "Build Status")](http://travis-ci.org/apauley/erlcdt)

This is a library that does parsing and validation in Erlang of some
commonly used input types.

Currently only South African ID numbers are parsed and validated in
this library.

## Use Case Philosophy

> &ldquo;The string is a stark data structure and everywhere it is passed there is much duplication of process. It is a perfect vehicle for hiding information.&rdquo;
>
> &mdash; <cite>Alan J. Perlis, [Epigrams in Programming, #34](http://www.cs.yale.edu/quotes.html)</cite>

I frequently see input fields, database fields and other information
in programs that are treated as if they are strings, when they can
rather be converted to a specific data type that has made all the
hidden information visible.

In this library every supported type will have a from_str/1 function
that parses it into a well-defined data type.

Validation of the input may happen at parse time if it makes sense for
the type, otherwise a separate validate/1 function will be provided
that validates the already parsed data type. In the case of RSA ID
number, validation happens at parse time.

The corresponding to_str/1 function will convert the type back to the
original string.

The idea is that any input should be converted to a well-defined type
as soon as possible, and for the duration of the program the *type* is
passed around as needed, not the original string. Utility functions
can be provided that operate on the type, eg. to extract the gender
from an ID number. Only when needed should the type be converted back
to string, eg. for display purposes or if your storage backend cannot
store well-defined types.

As an implementation note, I am using this library as an opportunity
to see what benefit Erlang programs can get from adding
[type specifications](http://www.erlang.org/doc/reference_manual/typespec.html)
to functions, in conjunction with tools like
[dialyzer](http://www.erlang.org/doc/man/dialyzer.html) and
[proper](https://github.com/manopapad/proper) (a property-based test
tool inspired by [QuickCheck](http://www.quviq.com/)).

## Building

This project uses rebar:

```bash
$ ./rebar get-deps compile
$ ./rebar compile skip_deps=true eunit
```

## South African ID Usage Examples

### Convert from string and to string

```erlang
1> {ok, ID} = rsa_id_number:from_str("4304041794068").
{ok,{rsa_id_number,{1943,4,4},1,794,0,6,8}}
2> rsa_id_number:to_str(ID).
"4304041794068"
```

### Some useful functions on ID numbers

```erlang
3> rsa_id_number:gender(ID).
female
4> rsa_id_number:citizen(ID).
rsa
```

### Validation

Only a valid ID number will return an ID type.
Invalid ID numbers will return an error when attempting to parse the ID number:

```erlang
5> rsa_id_number:from_str("4304041794067").
{error,{invalid_checksum,7}}
```


## Running the tests

There are property based tests (using proper) wrapped in eunit, in
addition to some normal eunit tests:

```bash
$ ./rebar compile skip_deps=true eunit
==> rel (compile)
==> erlcdt (compile)
==> rel (eunit)
==> erlcdt (eunit)
Compiled src/erlcdt_testhelper.erl
Testing rsa_id_number:checksum/1
................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
OK: Passed 2000 test(s).

Testing rsa_id_number:citizen/1
................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
OK: Passed 2000 test(s).

Testing rsa_id_number:gender/1
................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
OK: Passed 2000 test(s).

Testing rsa_id_number:date_from_str/1
................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
OK: Passed 2000 test(s).

Testing rsa_id_number:to_str/1
................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
OK: Passed 2000 test(s).

Testing rsa_id_number:from_str/1
................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
OK: Passed 2000 test(s).

Testing erlcdt_utils:strip_century/1
..........................................................................................................................................................................................................................................................
OK: Passed 250 test(s).

Testing erlcdt_utils:tomorrow/0
..........................................................................................................................................................................................................................................................
OK: Passed 250 test(s).

Testing erlcdt_utils:yesterday/0
..........................................................................................................................................................................................................................................................
OK: Passed 250 test(s).

Testing erlcdt_utils:today/0
..........................................................................................................................................................................................................................................................
OK: Passed 250 test(s).

Testing erlcdt_utils:dob_str/1
..........................................................................................................................................................................................................................................................
OK: Passed 250 test(s).

Testing erlcdt_utils:odd_even_elements/1
..........................................................................................................................................................................................................................................................
OK: Passed 250 test(s).

  All 13 tests passed.
```

# LICENCE

Released under the MIT license, see LICENSE.md for details.
